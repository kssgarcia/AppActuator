{% extends "main/base.html" %}
{% load static %}
{% block content %}
<section class="home">
  <div class="container">
    <div class="button">
      <button class="inputs-button" type="button">Inputs</button>
    </div>
    <div class="cform">
      <form class="form-inputs" id="event" method="post">
        {% csrf_token %}
        {{ form }}
        <input type="submit" value="Submit" class="button-submit" id="submitBtn">
      </form>   
      <div class="exit">
        <div class="line-1"></div>
        <div class="line-2"></div>
      </div>
    </div>
  </div>
  <div class="ui-results">

    <div class="container-tabs">
      <button class="windowBtn-1">Results</button>
      <button class="windowBtn-2">mapGraph</button>
      <button class="windowBtn-3">Efficiency</button>
      <button class="windowBtn-4">Load</button>
      <button class="windowBtn-5">Info</button>
    </div>

    <div class="container-table window-1">
      <table id="table-result">
        <thead> <tr>
            <th>Count</th>
            <th>ActuatorLenInit</th>
            <th>Stroke</th>
            <th>Force[N]</th>
            <th>A2X</th>
            <th>A2Y</th>
            <th>A1X</th>
            <th>A1Y</th>
            <th>ActuatorLenEnd</th>
          </tr> </thead>
          <tbody></tbody>
      </table>
    </div>

    <div class="container-mapGraph window-2">
      <canvas id="my-mapGraph"></canvas>
    </div>

    <div class="container-efficiency window-3">
      <canvas id="my-efficiency"></canvas>
    </div>

    <div class="container-load window-4">
      <canvas id="my-load"></canvas>
    </div>

    <div class="container-info window-5">
      <canvas id="my-info"></canvas>
    </div>
  </div>
</section>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.7.1/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-beta1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.6.1/chart.min.js" integrity="sha512-O2fWHvFel3xjQSi9FyzKXWLTvnom+lOYR/AUEThL/fbP4hv1Lo5LCFCGuTXBRyKC4K4DJldg5kxptkgXAzUpvA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="{% static 'main/js/mobile.js' %}"></script>
<script src="{% static 'main/js/tabs.js' %}"></script>
<script src="{% static 'main/js/tableSort.js' %}"></script>
<script src="{% static 'main/js/numGraph.js' %}"></script>
<script>

  const submitBtn = document.querySelector(".home .container .cform .button-submit")
  let data = "{{data|escapejs}}"
  if (data.length >= 7) 
  {
      displayResult()
  }
  function displayResult () {
      //event.preventDefault()
      let dataFil = data.substr(1, data.length-1)
      let dataFil2 = dataFil.substr(1, dataFil.length-3)

      const dat = JSON.parse(dataFil2)

      // Display Table
      let resultTable = document.querySelector("#table-result tbody")
      const searchData = dat.dataSearch
      for (let i=0; i<searchData.Count.length; i++ )
      { 
          resultTable.innerHTML += `<tr>
 <td>${searchData["Count"][i]}</td>
 <td>${searchData["ActuatorLenInit"][i].toFixed(3)}</td>
 <td>${searchData["Stroke"][i].toFixed(3)}</td>
 <td>${searchData["Force[N]"][i].toFixed(2)}</td>
 <td>${searchData["A2X"][i].toFixed(3)}</td>
 <td>${searchData["A2Y"][i].toFixed(3)}</td>
 <td>${searchData["A1X"][i].toFixed(3)}</td>
 <td>${searchData["A1Y"][i].toFixed(3)}</td>
 <td>${searchData["ActuatorLenEnd"][i].toFixed(3)}</td>
 </tr>`
        }

      // Display Load
      const loadTag = document.getElementById('my-load').getContext('2d')
      const labelLoad = dat.dataXYOption[0].map(d => d.toFixed(2))
      const dataLoad = {
          labels: labelLoad,
          datasets: [{
              label: 'Load vs Rotation',
              backgroundColor: 'orange',
              borderColor: 'orange',
              data: dat.dataXYOption[1].map(d => d.toFixed(2)),
            }]
        }
      const myChart1 = new Chart(
          loadTag, 
          {
              type: 'line',
              data: dataLoad,
              options: {maintainAspectRatio: false}
            }
        )

      // Display Efficiency
      const efficiencyTag = document.getElementById('my-efficiency').getContext('2d')
      const labelEffi = dat.dataEfficiency[0].map(d => d.toFixed(2))
      const dataEffi = {
          labels: labelEffi,
          datasets: [{
              label: 'Efficiency',
              backgroundColor: 'orange',
              borderColor: 'orange',
              data: dat.dataEfficiency[1].map(d => d.toFixed(2)),
            }]
        }
      const myChart2 = new Chart(
          efficiencyTag,
          {
              type: 'line',
              data: dataEffi,
              options: {maintainAspectRatio: false}
            }
        )

      // Display maps
      var plotDataMapA1 = [];
      var plotDataMapA2 = [];
      for (var i=0; i < dat.mapData[0].length; i++) {
          plotDataMapA1.push({'x': dat.mapData[0][i], 'y': dat.mapData[1][i]});
          plotDataMapA2.push({'x': dat.mapData[2][i], 'y': dat.mapData[3][i]});
        }
      const mapTag = document.getElementById('my-mapGraph').getContext('2d')
      const dataMap = {
          datasets: [{
              label: 'A1 Coordinates',
              backgroundColor: 'orange',
              borderColor: 'orange',
              data: plotDataMapA1,
            },
              {
                  label: 'A2 Coordinates',
                  backgroundColor: 'blue',
                  borderColor: 'blue',
                  data: plotDataMapA2,
                }]
        }
      const myChart3 = new Chart(
          mapTag,
          {
              type: 'scatter',
              data: dataMap,
              options: {maintainAspectRatio: false}
            }
        )

    }
</script>
{% endblock content %}
